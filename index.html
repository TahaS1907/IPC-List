<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <title>IPC Finder</title>

  <!-- SheetJS (Excel okuma için) -->
  <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

  <style>
    :root {
      --bg: #a8a2a2;
      --panel: #121214;
      --panel-soft: #111827;
      --muted: #9ca3af;
      --text: #f9fafb;
      --red: #ef4444;
      --red-soft: #7f1d1d;
      --border: #1f2937;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body { background: var(--bg); color: var(--text); font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif; }
    .wrap { max-width: 1200px; margin: 0 auto; padding: 24px; }

    .bar { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
    .title-block { display: flex; flex-direction: column; gap: 4px; }
    .badge { background: var(--red-soft); color: var(--text); padding: 2px 8px; border-radius: 999px; font-size: 12px; border: 1px solid var(--border); }
    .title { font-weight: 700; font-size: 22px; letter-spacing: .4px; }
    .subtitle { font-size: 13px; color: var(--muted); }
    .logo { height: 32px; }

    .panel { background: var(--panel); border: 1px solid var(--border); border-radius: 14px; padding: 14px; }
    .grid { display: grid; gap: 12px; }
    @media (min-width: 880px) {
      .grid-2 { grid-template-columns: 1fr 1fr; }
      .grid-3 { grid-template-columns: 1fr 1fr 1fr; }
    }

    .label { font-size: 12px; color: var(--muted); margin-bottom: 4px; }
    .input, .select {
      width: 100%;
      background: #020617;
      border: 1px solid var(--border);
      color: var(--text);
      padding: 8px 10px;
      border-radius: 10px;
      font-size: 14px;
    }
    .select { background: #111827; }
    .hint { font-size: 12px; color: var(--muted); margin-top: 6px; }

    .counter-chip {
      background: #1f2937;
      color: var(--text);
      padding: 2px 10px;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-size: 12px;
    }

    .card { background: var(--panel-soft); border: 1px solid var(--border); border-radius: 16px; padding: 14px; }
    .row { display: grid; gap: 10px; }
    @media (min-width: 880px) {
      .row-3 { grid-template-columns: 1fr 1fr 1fr; }
      .row-2 { grid-template-columns: 1fr 1fr; }
    }

    .kv { border: 1px solid var(--border); border-radius: 10px; padding: 8px; }
    .kv-k { font-size: 10px; color: var(--muted); text-transform: uppercase; letter-spacing: .6px; }
    .kv-v { margin-top: 4px; font-size: 13px; }

    .imgbox {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 8px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      align-items: center;
      justify-content: center;
      min-height: 120px;
      background: #020617;
    }
    .imgbox img {
      max-height: 220px;
      max-width: 100%;
      object-fit: contain;
      border-radius: 10px;
    }

    .note { font-size: 12px; color: var(--muted); font-style: italic; margin-top: 6px; }
    .muted { color: var(--muted); }
    .pnmono {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-size: 14px;
    }
    .topline { display: flex; align-items: center; justify-content: space-between; gap: 8px; margin-bottom: 6px; }
    .sheet-pill { font-size: 11px; color: var(--muted); }
  </style>
</head>
<body>
<div class="wrap">
  <header class="bar">
    <div class="title-block">
      <div class="badge">IPC Finder</div>
      
    
    </div>
    <!-- İstersen aynı klasöre logo.png koyarsan burada görünür -->
    <img src="logo2.png" alt="Logo" class="logo" onerror="this.style.display='none';" />
  </header>

  <!-- Filtre alanı -->
  <section class="panel grid grid-3" style="margin-bottom: 12px;">
    <div>
      <div class="label">Uçak Tipi (Sheet)</div>
      <select id="sheetSelect" class="select"></select>
      <div class="hint">Excel'in sheet isimleri (A320, A321, A330, B737, ...)</div>
    </div>
    <div>
      <div class="label">PN Ara</div>
      <input id="pnInput" class="input" placeholder="Örn: 3840160-8" />
      <div class="hint">PN tam veya kısmi yazabilirsin (PN içinde geçen).</div>
    </div>
    <div>
      <div class="label">Toplam Sonuç</div>
      <div style="margin-top: 8px;">
        <span id="resultCount" class="counter-chip">0</span>
      </div>
      <div class="hint">Seçili sheet + PN filtresine göre.</div>
    </div>
  </section>

  <!-- Sonuçlar -->
  <section id="results"></section>
</div>

<script>
  // Buraya Excel'den okunmuş veriler gelecek
  let IPC_DATA = {};

  // Bir satırdan, başlık eşleştirmeli değer alma (case-insensitive)
  function pick(row, keys) {
    const map = {};
    for (const k in row) {
      if (!Object.prototype.hasOwnProperty.call(row, k)) continue;
      map[k.toString().trim().toLowerCase()] = row[k];
    }
    for (const wanted of keys) {
      const w = wanted.toLowerCase();
      if (map[w] !== undefined && map[w] !== null && map[w] !== "") return map[w];
    }
    return "";
  }

  function normalizeStr(v) {
    if (v === undefined || v === null) return "";
    return String(v).trim();
  }

  function kv(label, value) {
    return (
      '<div class="kv">' +
        '<div class="kv-k">' + label + '</div>' +
        '<div class="kv-v">' + (value !== "" && value !== null && value !== undefined ? value : "-") + '</div>' +
      "</div>"
    );
  }

  function createCard(row) {
    const imgSrc = "images/" + (row.pn || "").toString().trim() + ".png";
    const imgHtml =
      '<img src="' + imgSrc + '" alt="' + (row.pn || "") +
      '" onerror="this.style.display=\'none\';" />';

    return (
      '<article class="card">' +
        '<div class="topline">' +
          '<div class="pnmono">' + (row.pn || "(PN yok)") + "</div>" +
          '<div class="sheet-pill">Chapter: ' + (row.chapter || "-") + "</div>" +
        "</div>" +

        '<div class="row row-3" style="margin-top: 10px;">' +
          kv("Açıklama", row.desc) +
          kv("İlgili", row.ilgili) +
          kv("Sub Category", row.subcat) +
        "</div>" +

        '<div class="row row-3" style="margin-top: 10px;">' +
          kv("Chapter", row.chapter) +
          kv("Qty", row.qty) +
          kv("FA Amount", row.amount) +
        "</div>" +

        '<div class="row" style="margin-top: 10px;">' +
          kv("Fonksiyonu", row.func) +
        "</div>" +

        '<div class="row row-2" style="margin-top: 12px;">' +
          '<div class="imgbox">' + imgHtml + "</div>" +
          '<div class="kv"><div class="kv-k">Resim Notu</div><div class="kv-v">' +
            (row.note || "-") +
          "</div></div>" +
        "</div>" +
      "</article>"
    );
  }

  function render() {
    const sheetSelect = document.getElementById("sheetSelect");
    const pnInput = document.getElementById("pnInput");
    const results = document.getElementById("results");
    const countChip = document.getElementById("resultCount");

    const sheet = sheetSelect.value;
    const pnQ = (pnInput.value || "").toString().trim().toUpperCase();

    const allRows = IPC_DATA[sheet] || [];
    const filtered = allRows.filter((r) => {
      if (!pnQ) return true;
      const pn = (r.pn || "").toString().toUpperCase();
      const desc = (r.desc || "").toString().toUpperCase();
      return pn.includes(pnQ) || desc.includes(pnQ);
    });

    countChip.textContent = filtered.length;

    if (!filtered.length) {
      results.innerHTML =
        '<div class="panel" style="margin-top: 12px;"><span class="muted">Sonuç yok. PN veya sheet filtresini kontrol et.</span></div>';
      return;
    }

    const html =
      '<div class="grid" style="gap: 12px; margin-top: 12px;">' +
      filtered.map(createCard).join("") +
      "</div>";
    results.innerHTML = html;
  }

  async function loadExcel() {
    try {
      // Aynı klasördeki IPC list.xlsx dosyasını oku
      const response = await fetch("IPC list.xlsx");
      if (!response.ok) {
        console.error("Excel dosyası bulunamadı veya okunamadı");
        return;
      }
      const arrayBuffer = await response.arrayBuffer();
      const workbook = XLSX.read(arrayBuffer, { type: "array" });

      IPC_DATA = {};
      workbook.SheetNames.forEach((sheetName) => {
        if (sheetName === "Uçak sayıları") return; // bu sayfayı atla
        const ws = workbook.Sheets[sheetName];
        const json = XLSX.utils.sheet_to_json(ws, { defval: "" });

        const records = json
          .map((row) => {
            const pn = normalizeStr(pick(row, ["PID_PN", "pid_pn", "PN", "pn"]));
            const desc = normalizeStr(pick(row, ["PN DESC", "pn desc", "Description"]));
            const ilgili = normalizeStr(pick(row, ["ilgili", "İlgili", "System"]));
            const chapter = normalizeStr(pick(row, ["Chapter", "CHAPTER", "ATA"]));
            const subcat = normalizeStr(pick(row, ["Sub Category", "Sub category", "SUB CATEGORY"]));
            const qty = normalizeStr(pick(row, ["QTY", "Qty", "qty"]));
            const amount = normalizeStr(pick(row, ["FA Amount", "fa amount", "Amount"]));
            const func = normalizeStr(pick(row, ["Fonksiyonu", "fonksiyonu", "Function"]));
            const note = normalizeStr(pick(row, ["Resim notu", "resim notu", "Image note"]));

            if (!pn && !desc) return null;

            return {
              pn,
              desc,
              ilgili,
              chapter,
              subcat,
              qty,
              amount,
              func,
              note,
            };
          })
          .filter(Boolean);

        IPC_DATA[sheetName] = records;
      });

      const sheetSelect = document.getElementById("sheetSelect");
      sheetSelect.innerHTML = "";
      Object.keys(IPC_DATA).forEach((s) => {
        const opt = document.createElement("option");
        opt.value = s;
        opt.textContent = s;
        sheetSelect.appendChild(opt);
      });

      if (Object.keys(IPC_DATA).length) {
        sheetSelect.value = Object.keys(IPC_DATA)[0];
      }

      sheetSelect.addEventListener("change", render);
      document.getElementById("pnInput").addEventListener("input", render);

      render();
    } catch (err) {
      console.error("Excel yüklenirken hata:", err);
    }
  }

  // Sayfa açılınca Excel'i otomatik yükle
  window.addEventListener("DOMContentLoaded", loadExcel);
</script>
</body>
</html>



